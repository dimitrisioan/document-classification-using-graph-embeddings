program
wmprotocols
in
open
look
toolkit
hi
all
i
am
studying
the
book
unix
desktop
guide
to
open
look
there
is
an
example
winpropc
that
demonstrate
how
to
program
wmprotocols
property
in
chapter
it
can
run
but
only
show
the
static
text
messages
no
notice
popup
what
is
the
problem
thanks
in
advance
for
iop
file
winpropc
shows
how
to
set
properties
on
a
window
include
for
definition
of
xaatom
include
include
include
xolopenlookh
include
xolstatictexth
include
xoloblongbutth
include
xolnoticeh
this
file
defines
the
atoms
with
ol
prefix
id
of
the
toplevel
and
noticeshell
widget
static
widget
toplevel
noticeshell
static
widget
makenotice
static
char
message
clients
use
properties
to
communicate
with
the
window
manager
this
example
illustrates
how
an
open
look
application
requests
notification
from
the
window
manager
when
certain
events
occur
the
communication
is
in
the
form
of
a
clientmessage
event
that
the
application
processes
in
an
eventhandler
atoms
used
for
interclient
communication
atom
atomwmprotocols
atomwmdeletewindow
atomwmsaveyourself
static
void
handlewmmessages
static
void
saveandexit
static
void
saveyourself
static
void
popnotice
static
void
doexit
string
to
hold
comand
line
for
use
in
responding
to
the
wmsaveyourself
protocol
message
char
void
mainargc
argv
int
argc
char
argv
widget
w
int
i
save
the
commandline
for
use
in
responding
to
the
wmsaveyourself
protocol
message
sprintfsavedcmdline
s
ifargc
fori
i
argc
i
strcatsavedcmdline
argvi
strcatsavedcmdline
create
and
initialize
the
toplevel
widget
toplevel
olmain
null
argc
argv
create
a
statictext
widget
w
xtvacreatemanagedwidgetstext
statictextwidgetclass
toplevel
xtnstring
message
xtnwidth
null
create
a
noticeshell
widget
for
later
use
makenoticetoplevel
intern
the
atoms
atomwmprotocols
xinternatomxtdisplayw
wmprotocols
false
atomwmdeletewindow
xinternatomxtdisplayw
wmdeletewindow
false
atomwmsaveyourself
xinternatomxtdisplayw
wmsaveyourself
false
add
an
eventhandler
to
process
clientmessage
events
sent
by
the
window
manager
xtaddeventhandlertoplevel
noeventmask
true
handlewmmessages
null
realize
the
widgets
and
start
processing
events
xtrealizewidgettoplevel
append
the
properties
wmdeletewindow
and
wmsaveyourself
to
the
definition
of
the
wmprotocols
property
this
step
requires
the
window
id
of
the
toplevel
widget
the
window
id
is
valid
only
after
the
widget
is
realized
xchangepropertyxtdisplaytoplevel
xtwindowtoplevel
atomwmprotocols
xaatom
propmodeappend
atomwmdeletewindow
xchangepropertyxtdisplaytoplevel
xtwindowtoplevel
atomwmprotocols
xaatom
propmodeappend
atomwmsaveyourself
xtmainloop
static
void
handlewmmessagesw
clientdata
pevent
widget
w
xtpointer
clientdata
xevent
pevent
ifpeventtype
clientmessage
peventxclientmessagetype
atomwmprotocols
atomwmdeletewindow
saveandexit
atomwmsaveyourself
saveyourself
static
void
saveandexit
display
a
notice
giving
the
user
a
chance
to
respond
popnoticetoplevel
noticeshell
static
void
saveyourself
set
the
wmcommand
property
to
the
saved
commandline
xchangepropertyxtdisplaytoplevel
xtwindowtoplevel
xawmcommand
xastring
propmodereplace
savedcmdline
strlensavedcmdline
static
widget
makenoticeparent
widget
parent
widget
w
ntext
ncontrol
nexit
ncancel
create
a
button
and
provide
a
callback
to
pop
up
a
notice
w
xtvacreatemanagedwidgetquitbutton
oblongbuttonwidgetclass
parent
xtnlabel
exit
null
xtaddcallbackw
xtnselect
popnotice
null
create
the
noticeshell
widget
note
that
you
have
to
use
xtvacreatepopupshell
instead
of
the
usual
xtvacreatemanagedwidget
noticeshell
xtvacreatepopupshellquitnotice
noticeshellwidgetclass
w
null
get
the
id
of
the
text
and
control
area
widgets
of
the
noticeshell
xtvagetvaluesnoticeshell
xtntextarea
ntext
xtncontrolarea
ncontrol
null
place
a
message
in
the
text
area
of
the
noticeshell
xtvasetvaluesntext
xtnstring
please
confirm
exit
from
program
null
add
buttons
to
the
control
area
of
the
noticeshell
each
button
has
an
appropriate
callback
nexit
xtvacreatemanagedwidgetnoticeexit
oblongbuttonwidgetclass
ncontrol
xtnlabel
exit
null
xtaddcallbacknexit
xtnselect
doexit
null
ncancel
xtvacreatemanagedwidgetnoticecancel
oblongbuttonwidgetclass
ncontrol
xtnlabel
cancel
xtndefault
true
null
return
w
static
void
popnoticewemanate
wnotice
widget
wemanate
wnotice
xtvasetvalueswnotice
xtnemanatewidget
wemanate
null
pop
up
the
noticeshell
widget
the
noticeshell
widget
makes
sure
that
the
aplication
waits
until
the
user
selects
from
one
of
the
buttons
in
the
noticeshells
control
area
xtpopupwnotice
xtgrabexclusive
static
void
doexitw
calldata
clientdata
widget
w
xtpointer
calldata
clientdata
xclosedisplayxtdisplayw
